#!/bin/bash
set -e

# Solo en producción queremos preparar/sembrar la base de datos
if [ "$RAILS_ENV" = "production" ]; then
  if [ "$RESET_VOLUMES" = "true" ]; then
    echo "🔄 RESET_VOLUMES=true → ejecutando db:setup (create + migrate + seed)"
    bundle exec rails db:setup
  else
    echo "⚙️ RESET_VOLUMES!=true → ejecutando db:prepare"
    bundle exec rails db:prepare
  fi
fi

# Luego ejecuta el CMD normal (ej. Puma)
exec "$@"
